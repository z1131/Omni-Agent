services:
  omni-agent:
    image: crpi-16uyo5eg9cykcl2r.cn-hangzhou.personal.cr.aliyuncs.com/omni_agent/omni-agent:latest
    container_name: omni-agent
    restart: unless-stopped
    env_file:
      - /etc/deepknow.env
    ports:
      - "8000:8000"
      - "50051:50051"
    environment:
      TZ: Asia/Shanghai
      HOST: "0.0.0.0"
      PORT: "8000"
      GRPC_ENABLED: "true"
      GRPC_PORT: "50051"
      LOG_LEVEL: "INFO"
      LOG_FORMAT: "json"
      
      # Nacos 配置 (内网)
      NACOS_ENABLED: "true"
      NACOS_SERVER_ADDR: "172.17.150.78:8848"
      NACOS_NAMESPACE: "public"
      NACOS_USERNAME: "nacos"
      NACOS_PASSWORD: ${NACOS_PASSWORD}
      NACOS_SERVICE_NAME: "omni-agent"
      NACOS_GROUP: "DEEPKNOW_GROUP"
      SERVICE_IP: "172.17.150.78"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
