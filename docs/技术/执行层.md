# 执行层

## 职责

执行层管理 Agent 可用的工具，负责：
- 工具注册与发现
- 工具启用/禁用
- MCP 协议工具集成
- 配置持久化

## 使用方式

### ToolManager

```python
from src.action.manager import get_tool_manager, init_tool_manager

# 初始化（应用启动时调用）
manager = init_tool_manager()

# 获取所有工具
tools = manager.get_all_tools()
for tool in tools:
    print(f"{tool.id}: {tool.name} - {'启用' if tool.enabled else '禁用'}")

# 启用/禁用工具
manager.enable_tool("code_interpreter")
manager.disable_tool("web_search")
manager.toggle_tool("code_interpreter")

# 获取启用的工具（给 Agent 用）
enabled_tools = manager.get_enabled_tools()
agent = OmniAgent(function_list=enabled_tools)
```

### 注册内置工具

```python
from qwen_agent.tools import BaseTool

class MyTool(BaseTool):
    name = "my_tool"
    description = "我的工具"
    
    def call(self, params: str, **kwargs):
        return "result"

manager.register_builtin_tool(
    MyTool,
    category="Custom",
    enabled=True,
)
```

### MCP 工具

```python
from src.action.mcp_client import get_mcp_client, MCPServerConfig

mcp = get_mcp_client()

# 添加 MCP 服务器
config = MCPServerConfig(
    id="filesystem",
    name="文件系统",
    description="文件读写操作",
    command="npx",
    args=["-y", "@anthropic/mcp-server-filesystem", "/tmp"],
)
mcp.add_server(config)

# 启用
mcp.enable_server("filesystem")

# 获取工具（自动集成到 Agent）
tools = mcp.get_enabled_tools_for_agent()
```

## 注意事项

| 注意点 | 说明 |
|-------|-----|
| 配置持久化 | 工具状态保存在 `config/tools.json` |
| MCP 默认禁用 | MCP 工具需要手动启用 |
| 懒加载 | 工具实例在需要时才创建 |
| 分类管理 | 通过 `category` 组织工具 |

## 内置工具

| 工具 | 分类 | 默认状态 |
|-----|-----|---------|
| `code_interpreter` | Development | 启用 |
| `file_reader` | File Operations | 启用 |
| `web_search` | Research | 禁用 |

## MCP 服务器模板

预置的 MCP 服务器模板：

```python
from src.action.mcp_client import MCP_SERVER_TEMPLATES

# 可用模板
templates = MCP_SERVER_TEMPLATES.keys()
# ['filesystem', 'github', 'postgres', ...]
```
